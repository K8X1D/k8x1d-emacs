#!/bin/sh
# Adapted from https://guix.gnu.org/cookbook/en/html_node/Reproducible-profiles.html

K8X1D_EMACS_PROFILES=$HOME/.k8x1d-emacs-profiles
K8X1D_EMACS=$HOME/.k8x1d-emacs

mkdir -p "$K8X1D_EMACS/$XDG_SESSION_TYPE"
guix pull --channels=channels.scm --profile="$K8X1D_EMACS/$XDG_SESSION_TYPE/guix"

mkdir -p "$K8X1D_EMACS_PROFILES/$XDG_SESSION_TYPE"
"$K8X1D_EMACS/$XDG_SESSION_TYPE"/guix/bin/guix package --manifest=k8x1d-emacs.scm --profile="$K8X1D_EMACS_PROFILES/$WIN/$WIN"
