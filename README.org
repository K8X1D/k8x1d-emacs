
* Set-up
** Mise en place guix avec channels
#+begin_src shell :async true :session emacs-guix
  EMACS_DIR=$HOME/.config/emacs-guix
  GUIX_PROFILE=$EMACS_DIR/guix/guix-profile
  mkdir -p $EMACS_DIR/guix
  guix pull --channels="$EMACS_DIR/channels.scm" --profile=$GUIX_PROFILE
#+end_src

** Mise en place du profile
#+begin_src shell :async true :session emacsguix :results value
  EMACS_DIR=$HOME/.config/emacs-guix
  EMACS_PROFILE=$EMACS_DIR/guix/emacs-profile
  GUIX_PROFILE=$EMACS_DIR/guix/guix-profile
  GUIX=$GUIX_PROFILE/bin/guix
  mkdir -p "$EMACS_DIR/guix"
  $GUIX package --profile=$EMACS_PROFILE --manifest=$EMACS_DIR/manifest.scm 
#+end_src

#+RESULTS:
#+begin_example
k8x1d@frame13 ~/.config/emacs-guix (master)
k8x1d@frame13 ~/.config/emacs-guix (master)
k8x1d@frame13 ~/.config/emacs-guix (master)
k8x1d@frame13 ~/.config/emacs-guix (master)
k8x1d@frame13 ~/.config/emacs-guix (master)
k8x1d@frame13 ~/.config/emacs-guix (master)
default-gnu-imported-modules' instead
guix package: warning: Consider running 'guix pull' followed by
'guix package -u' to get up-to-date packages and security updates.

The following packages will be installed:
   emacs-lsp-booster    0.2.0
   emacs-next-pgtk      30.0.60-1.4e22ef8
   gcc-toolchain        11.4.0
   libtool              2.4.7
   perl                 5.36.0
   texlive-bin          2024.2
   texlive-dvipng-bin   2024.2
   texlive-lacheck      2024.2
   texlive-scheme-basic 2024.2
   texlive-ulem         2024.2

The following derivation will be built:
  /gnu/store/9bxjcalpvyxc8xgki7jzxlb48zxw2dl8-profile.drv

building CA certificate bundle...
listing Emacs sub-directories...
building fonts directory...
generating GdkPixbuf loaders cache...
generating GLib schema cache...
creating GTK+ icon theme cache...
building cache files for GTK+ input methods...
building directory of Info manuals...
building TeX Live font maps...
building XDG desktop file cache...
building XDG MIME database...
building profile with 10 packages...
hint: Consider setting the necessary
environment variables by running:

     GUIX_PROFILE="/home/k8x1d/.config/emacs-guix/guix/emacs-profile"
GUIX_PROFILE/etc/profile"

Alternately, see `guix package
--search-paths -p
"/home/k8x1d/.config/emacs-guix/guix/
emacs-profile"'.

k8x1d@frame13 ~/.config/emacs-guix (master)
0
k8x1d@frame13 ~/.config/emacs-guix (master)
#+end_example

** Fixation des channels
#+begin_src shell :async true :session emacs-guix
  EMACS_DIR=$HOME/.config/emacs-guix
  GUIX=$EMACS_DIR/guix/emacs/bin/guix
  source "$GUIX_PROFILE/etc/profile"

  # Generate our initial =channels-lock.scm= Commit this to your emacs dotfiles repository.
  $GUIX describe --format=channels > $EMACS_DIR/channels-lock.scm
#+end_src

** Lancement d'emacs
#+begin_src shell  :async true :session emacs-guix :mkdirp true :tangle ~/.config/emacs-guix/bin/emacs-guix :shebang "#!/bin/sh"
  EMACS_DIR=$HOME/.config/emacs-guix
  EMACS_PROFILE="$EMACS_DIR/guix/emacs-profile"
  EMACS=$EMACS_PROFILE/bin/emacs
  EMACSLOADPATH=$EMACSLOADPATH:$EMACS_PROFILE/share/emacs/site-lisp/
  $EMACS --init-directory=$EMACS_DIR --debug-init "$@"
#+end_src

#+RESULTS:
#+begin_example
k8x1d@frame13 ~/.config/emacs-guix (master)
k8x1d@frame13 ~/.config/emacs-guix (master)
k8x1d@frame13 ~/.config/emacs-guix (master)
k8x1d@frame13 ~/.config/emacs-guix (master)
k8x1d@frame13 ~/.config/emacs-guix (master)
Gdk-Message: 06:44:23.130: Unable to load sb_v_double_arrow from the cursor theme
Gdk-Message: 06:44:23.130: Unable to load sb_h_double_arrow from the cursor theme
Gdk-Message: 06:44:23.143: Unable to load hand2 from the cursor theme
Gdk-Message: 06:44:23.143: Unable to load sb_h_double_arrow from the cursor theme
Gdk-Message: 06:44:23.143: Unable to load sb_v_double_arrow from the cursor theme

(emacs:14078): Gdk-WARNING **: 06:44:25.837: ../gtk+-3.24.41/gdk/wayland/gdkcursor-wayland.c:242 cursor image size (9x16) not an integermultiple of scale (2)
#+end_example

** TODO Nettoyage 

#+begin_src shell :async true :session emacsguix :results value
  EMACS_DIR=$HOME/.config/emacs-guix
  EMACS_PROFILE=$EMACS_DIR/guix/emacs-profile
  GUIX_PROFILE=$EMACS_DIR/guix/guix-profile
  GUIX=$GUIX_PROFILE/bin/guix
  mkdir -p "$EMACS_DIR/guix"
  $GUIX package --profile=$EMACS_PROFILE --manifest=$EMACS_DIR/manifest.scm 
#+end_src
